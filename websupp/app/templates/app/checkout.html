{% load custom_filters %}

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mt-3 container">
          {{ message }}
        </div>
    {% endfor %}
    {% for product_id in selected_products %}
        <input type="hidden" name="selected_products" value="{{ product_id }}">
    {% endfor %}
{% endif %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>X√°c nh·∫≠n ƒë∆°n h√†ng</title>

    <!-- Bootstrap CDN (n·∫øu mu·ªën d√πng c√°c class s·∫µn c√≥) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom style -->
    <style>
        body {
            background: linear-gradient(to bottom right, #2e2e2e, #000000);
            color: #333;
            font-family: Arial, sans-serif;
        }
        .form-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            margin-top: 50px;
        }
        .form-container h2 {
            color: #e63946;
            font-weight: bold;
        }
        .form-label {
            font-weight: bold;
            color: #333;
        }
        .form-control {
            border-radius: 10px;
            border: 1px solid #ccc;
        }
        .form-check {
            background-color: #f9f9f9;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        .form-check:hover {
            background-color: #ffe8e8;
        }
        .total-box {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 10px;
            padding: 15px;
            text-align: right;
        }
        .btn-confirm {
            background: linear-gradient(to right, #e63946, #f65e13);
            border: none;
            color: #fff;
            font-weight: bold;
            padding: 12px;
            font-size: 16px;
            border-radius: 12px;
            width: 100%;
            transition: background 0.3s;
        }
        .btn-confirm:hover {
            background: linear-gradient(to right, #d62828, #f2541b);
        }
    </style>

    <!-- Th√™m SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="container">
    <form method="post" class="form-container mx-auto max-width-md" id="checkoutForm" action="{% url 'checkout' %}">
        {% csrf_token %}

        <h2 class="mb-4"><span>üèãÔ∏è‚Äç‚ôÇÔ∏è</span> X√°c nh·∫≠n ƒë∆°n h√†ng</h2>

        <!-- ƒê·ªãa ch·ªâ nh·∫≠n h√†ng -->
        <div class="mb-3">
            <label class="form-label" for="{{ form.address.id_for_label }}">üìç ƒê·ªãa ch·ªâ nh·∫≠n h√†ng <span class="text-danger">*</span></label>
            {{ form.address|add_class:"form-control" }}
            {% if form.address.errors %}
                <div class="text-danger small mt-1">{{ form.address.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- S·ªë ƒëi·ªán tho·∫°i -->
        <div class="mb-3">
            <label class="form-label" for="{{ form.phone.id_for_label }}">üìû S·ªë ƒëi·ªán tho·∫°i <span class="text-danger">*</span></label>
            {{ form.phone|add_class:"form-control" }}
            {% if form.phone.errors %}
                <div class="text-danger small mt-1">{{ form.phone.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
        <div class="mb-4">
            <label class="form-label d-block mb-2">üí≥ Ph∆∞∆°ng th·ª©c thanh to√°n <span class="text-danger">*</span></label>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="payment_method" value="cod" id="cod" {% if form.payment_method.value == 'cod' %}checked{% endif %} required>
                <label class="form-check-label" for="cod">üöö Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="payment_method" value="momo" id="momo" {% if form.payment_method.value == 'momo' %}checked{% endif %} required>
                <label class="form-check-label" for="momo">üì± V√≠ MoMo</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="payment_method" value="bank" id="bank" {% if form.payment_method.value == 'bank' %}checked{% endif %} required>
                <label class="form-check-label" for="bank">üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng</label>
            </div>

            {% if form.payment_method.errors %}
                <div class="text-danger small mt-1">{{ form.payment_method.errors.0 }}</div>
            {% endif %}
        </div>

        <!-- T·ªïng ti·ªÅn -->
        <div class="total-box mb-4">
            <p class="mb-0">üí∞ T·ªïng ti·ªÅn: <strong class="text-danger fs-5">{{ cart.get_total_price }} ƒë</strong></p>
        </div>

        <!-- N√∫t ƒë·∫∑t h√†ng -->
        <button type="submit" class="btn btn-confirm" onclick="showSuccessPopup(event)">
            üõí X√°c nh·∫≠n ƒë·∫∑t h√†ng
        </button>
    </form>
</div>

<!-- Th√™m script ·ªü cu·ªëi body -->
<script>
function showSuccessPopup(event) {
    event.preventDefault(); // NgƒÉn form submit ngay l·∫≠p t·ª©c
    
    // Ki·ªÉm tra form h·ª£p l·ªá
    const form = document.getElementById('checkoutForm');
    if (form.checkValidity()) {
        Swal.fire({
            title: 'ƒê·∫∑t h√†ng th√†nh c√¥ng!',
            text: 'C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng c·ªßa nh√≥m 8. Ch√∫ng t√¥i s·∫Ω s·ªõm li√™n h·ªá v·ªõi b·∫°n.',
            icon: 'success',
            confirmButtonText: 'OK',
            confirmButtonColor: '#e63946'
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit(); // Submit form sau khi click OK
            }
        });
    } else {
        form.reportValidity(); // Hi·ªÉn th·ªã validation errors
    }
}
</script>
</body>
</html>
